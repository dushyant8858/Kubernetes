1- Disable SElinux and Swap

2- Install docker and restart it

3- Add the kubernetes repo file :

cat <<EOF > /etc/yum.repos.d/kubernetes.repo

[kubernetes]

name=Kubernetes

baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64

enabled=1

gpgcheck=1

repo_gpgcheck=1

gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg

EOF

4- Install it using yum:

# yum install -y kubelet kubeadm kubectl

# systemctl enable kubelet && systemctl start kubelet

5- Intiate the Cluster and flannel network:

# kubeadm init --pod-network-cidr=10.244.0.0/16

Note : 

The Join command for the worker nodes will be :

# kubeadm join --token api-server-ip:6443 --discovery-token-ca-cert-hash sha256:

Note : The Token and the sha256 values will be generated by kubeadm command

6- Create the Dir and configs :

# sudo mkdir -p $HOME/.kube

# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config 

# sudo chown $(id -u):$(id -g) $HOME/.kube/config

7- Using the flannel networking for the cluster:

# kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

8- To verify that everything is Ok :

# kubectl get pods --all-namespaces

# kubtctl get nodes

Note : All K8S Ports are listed in the below URL :

https://stackoverflow.com/questions/39293441/needed-ports-for-kubernetes-cluster

so after adjusting the iptables or firewalld rules make sure to do the below :

cat <<EOF > /etc/sysctl.d/k8s.conf

net.bridge.bridge-nf-call-ip6tables = 1

net.bridge.bridge-nf-call-iptables = 1

EOF

sysctl --system
